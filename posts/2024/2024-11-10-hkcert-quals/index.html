<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>HKCERT CTF Quals 2024 Writeup (Part 1) :: Zayn</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Writeup for crypto challenges in HKCERT CTF Quals 2024 - RSA LCG Series" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/posts/2024/2024-11-10-hkcert-quals/" />


  





  
  <link rel="stylesheet" href="http://localhost:1313/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/main.min.fe8dc560fccb53a458b0db19ccb7b265764ac46b68596b7e099c6793054dd457.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/post.min.fc74ca360273c1d828da3c02b8174eba435607b369d98418ccc6f2243cd4e75d.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terminal.min.34d0b0e02c268ed4dc358b889f73fc70d0bd6561b4fba53a7cf62f4b3c239fca.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="http://localhost:1313/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="HKCERT CTF Quals 2024 Writeup (Part 1)">
<meta property="og:description" content="Writeup for crypto challenges in HKCERT CTF Quals 2024 - RSA LCG Series" />
<meta property="og:url" content="http://localhost:1313/posts/2024/2024-11-10-hkcert-quals/" />
<meta property="og:site_name" content="Zayn" />

  
  
    
  
  <meta property="og:image" content="http://localhost:1313/posts/2024/2024-11-10-hkcert-quals/hkcert2024.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2024-11-08 00:00:00 &#43;0000 UTC" />












</head>
<body>


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Zayn
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;â–¾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="/showcase" >Showcase</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/posts/2024/2024-11-10-hkcert-quals/">HKCERT CTF Quals 2024 Writeup (Part 1)</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-11-08</time><span class="post-author">Zayn</span></div>

  
  
  <img src="/posts/2024/2024-11-10-hkcert-quals/hkcert2024.png"
    class="post-cover"
    alt="HKCERT CTF Quals 2024 Writeup (Part 1)"
    title="Cover Image" />

  <div class="post-container">
  
    <aside class="table-of-contents">
      <h2>
        HKCERT CTF Quals 2024 Writeup (Part 1)
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#rsa-lcg-0">RSA LCG 0</a>
      <ul>
        <li><a href="#source-code">Source Code</a></li>
        <li><a href="#challenge-analysis">Challenge Analysis</a></li>
        <li><a href="#solve-script">Solve Script</a></li>
      </ul>
    </li>
    <li><a href="#rsa-lcg-1">RSA LCG 1</a>
      <ul>
        <li><a href="#source-code-1">Source Code</a></li>
        <li><a href="#challenge-analysis-1">Challenge Analysis</a></li>
        <li><a href="#solve-script-1">Solve Script</a></li>
      </ul>
    </li>
    <li><a href="#rsa-lcg-2">RSA LCG 2</a>
      <ul>
        <li><a href="#source-code-2">Source Code</a></li>
        <li><a href="#challenge-analysis-2">Challenge Analysis</a></li>
        <li><a href="#solve-script-2">Solve Script</a></li>
      </ul>
    </li>
    <li><a href="#rsa-lcg-3">RSA LCG 3</a>
      <ul>
        <li><a href="#source-code-3">Source Code</a></li>
        <li><a href="#challenge-analysis-3">Challenge Analysis</a></li>
        <li><a href="#solve-script-3">Solve Script</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </aside>
  

  <div class="post-content"><div>
        <p>This is the first time I play HKCERT CTF. Honestly, I&rsquo;ve been waiting for this occasion for so long since one of the crypto authors is my favorite - <code>@Mystiz</code>. Eventually, I solved 8/10 challenges. In this part, I&rsquo;ll present the solution for the <code>RSA LCG</code> series: <code>RSA LCG 0</code>, <code>RSA LCG 1</code>, <code>RSA LCG 2</code>, and <code>RSA LCG 3</code>.</p>
<h1 id="rsa-lcg-0">RSA LCG 0<a href="#rsa-lcg-0" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<h2 id="source-code">Source Code<a href="#source-code" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> reduce
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> operator <span style="color:#f92672">import</span> mul
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> secrets
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> isPrime <span style="color:#66d9ef">as</span> is_prime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, c<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, seed<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>seed <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(bits) <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(bits) <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>c <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(bits)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    FLAG <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environb<span style="color:#f92672">.</span>get(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;FLAG&#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;hkcert24{***REDACTED***}&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(<span style="color:#ae81ff">16</span>) <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    lcg <span style="color:#f92672">=</span> LCG(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">128</span>, seed<span style="color:#f92672">=</span>seed)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>lcg <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ps <span style="color:#f92672">=</span> [get_prime(lcg, bits<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> reduce(mul, ps)
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x10001</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(FLAG, <span style="color:#e6db74">&#39;big&#39;</span>)
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> pow(m, e, n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>n <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>e <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>c <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># lcg = LCG(bits=128, a=181525535962623036141846439269075744717, c=115518761677956575882056543847720910703)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># n = 481114791694785858695050549695538734046971417176843978882044871919616727765643820034066591387776993303130591599679964348353329376559922076715381691496791199317834852972956556186543750873476577029492255903246050392214315442941266567737558736141253495436298490003513325026207840446389886295321748490024615821174562383476857761918630446488869812894422048853097952363719756297344014883459670109643440173428469002028435568608888993928248402297380061528970024946401518041243564217741744613525402813984605478699738311132717493610790718032712239270654974446116711995328572373804563487208899590643981315012517538379075118546604524143430683964513429268368997878214614073305169449253802788601323508855536854500946367628892634824935231007194546528797696281628426050519984306590514055620223093615738335974270220301535497863462980632453977776013292134758089648072661829571370276168813518517058289217357255320627263734650032320305279867840420886394855960116879598125383109784504746667833173574005936871719063288584361794901458463052848937392072728849939635133710409996428462876274835371522565826839423046726308001047859782566419852401917763502007196004524754115471117969452116174478677547559057917128250716516531170082878464757039874318490906158689</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># e = 65537</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c = 345977789156696385683581168846000378215844867611205467179181525756923773343997491856273352579925123046597359189866939437231366570263052567113535467666353517443555775669947203980735918360811410985879753948221470545729133552842244535778330182549296248222039054438197983267418429814674564210947108838042963108251861548375535326969960093796185009763176002544709169063466256285182205803310470811843866647483609768051301160908646352263376778439044867189801653416628219979460525679135210530110143121851284249580066642389243748128010268277263972367956550837364650977683324140767090284085773301486622501777068017859676285398384937589784505599555747372780238872296757407155242584567297352399943303106161556729208284654934208601533197169169514879515899747537955886064112109885660797961038075757520138954391314283382301755474526387505278386817416193439304304484679228240909612236945218009947246430065957288065358434877715856330476675541582153869420244176864467086961698529560004535449279996657026744930241841052475481816491735959706500890907139027990119800255632071177694111432383236909734940374926954075681464953536382583119130818187839809617068848876572944726598351264384270260481762978383770917542259594389267566490962365207501538561114532291</span>
</span></span></code></pre></div><h2 id="challenge-analysis">Challenge Analysis<a href="#challenge-analysis" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>Among this series, the flag is encrypted with RSA. However the primes used by RSA is generated by a Linear Congruential Generator (LCG) with 4 parameters $a, c, bits, seed$. The state of LCG is updated as follow:
$$seed = a * seed + c \pmod{2^{bits}}$$</li>
<li>In this challenge, we are given 3 parameters of the LCG: $a, c, bits$. We also know that $seed$ is a 16-bit odd integer.</li>
<li>Since the range of $seed$ is pretty small, we can enumerate through all possible values of the seed, then generate the first prime $p0$ and check if $p \mathrel{|} n$</li>
</ul>
<h2 id="solve-script">Solve Script<a href="#solve-script" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> isPrime <span style="color:#66d9ef">as</span> is_prime
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> prod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a, c, seed):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_num</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lcg <span style="color:#f92672">=</span> LCG(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">128</span>, a<span style="color:#f92672">=</span><span style="color:#ae81ff">181525535962623036141846439269075744717</span>, c<span style="color:#f92672">=</span><span style="color:#ae81ff">115518761677956575882056543847720910703</span>, seed<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">481114791694785858695050549695538734046971417176843978882044871919616727765643820034066591387776993303130591599679964348353329376559922076715381691496791199317834852972956556186543750873476577029492255903246050392214315442941266567737558736141253495436298490003513325026207840446389886295321748490024615821174562383476857761918630446488869812894422048853097952363719756297344014883459670109643440173428469002028435568608888993928248402297380061528970024946401518041243564217741744613525402813984605478699738311132717493610790718032712239270654974446116711995328572373804563487208899590643981315012517538379075118546604524143430683964513429268368997878214614073305169449253802788601323508855536854500946367628892634824935231007194546528797696281628426050519984306590514055620223093615738335974270220301535497863462980632453977776013292134758089648072661829571370276168813518517058289217357255320627263734650032320305279867840420886394855960116879598125383109784504746667833173574005936871719063288584361794901458463052848937392072728849939635133710409996428462876274835371522565826839423046726308001047859782566419852401917763502007196004524754115471117969452116174478677547559057917128250716516531170082878464757039874318490906158689</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">345977789156696385683581168846000378215844867611205467179181525756923773343997491856273352579925123046597359189866939437231366570263052567113535467666353517443555775669947203980735918360811410985879753948221470545729133552842244535778330182549296248222039054438197983267418429814674564210947108838042963108251861548375535326969960093796185009763176002544709169063466256285182205803310470811843866647483609768051301160908646352263376778439044867189801653416628219979460525679135210530110143121851284249580066642389243748128010268277263972367956550837364650977683324140767090284085773301486622501777068017859676285398384937589784505599555747372780238872296757407155242584567297352399943303106161556729208284654934208601533197169169514879515899747537955886064112109885660797961038075757520138954391314283382301755474526387505278386817416193439304304484679228240909612236945218009947246430065957288065358434877715856330476675541582153869420244176864467086961698529560004535449279996657026744930241841052475481816491735959706500890907139027990119800255632071177694111432383236909734940374926954075681464953536382583119130818187839809617068848876572944726598351264384270260481762978383770917542259594389267566490962365207501538561114532291</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> seed <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> seed <span style="color:#f92672">%</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>seed <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>	lcg<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>	p <span style="color:#f92672">=</span> get_prime(lcg, <span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> p <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Found </span><span style="color:#e6db74">{</span>seed <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lcg<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>ps <span style="color:#f92672">=</span> [get_prime(lcg, <span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>phi <span style="color:#f92672">=</span> prod([p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> ps])
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span><span style="display:flex;"><span>print(long_to_bytes(m))
</span></span></code></pre></div><p><code>FLAG: hkcert24{0k4y_th1s_1s_n0t_ev3n_vu1n3r4b1e_b3c4u5e_0f_1cgs}</code></p>
<h1 id="rsa-lcg-1">RSA LCG 1<a href="#rsa-lcg-1" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<h2 id="source-code-1">Source Code<a href="#source-code-1" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> reduce
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> operator <span style="color:#f92672">import</span> mul
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> secrets
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> isPrime <span style="color:#66d9ef">as</span> is_prime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, c<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, seed<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>seed <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(bits) <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(bits) <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>c <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(bits)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    FLAG <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environb<span style="color:#f92672">.</span>get(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;FLAG&#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;hkcert24{***REDACTED***}&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    lcg <span style="color:#f92672">=</span> LCG(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>, c<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>lcg <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ps <span style="color:#f92672">=</span> [get_prime(lcg, bits<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> reduce(mul, ps)
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x10001</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(FLAG, <span style="color:#e6db74">&#39;big&#39;</span>)
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> pow(m, e, n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>n <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>e <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>c <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># lcg = LCG(bits=256, a=102197201962123846389438942955101245465045811321520032783251514372432272871077, c=0)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># n = 712650313276602240132329097304430048400352751513310575526412992129597422070848111072491134888258819603174150809317988369755331029009864211216547294646211646094933573124257136163629116984386416188859789467395164897001085191528084740453428500956450177548977865861466055171717564208692444769495508512419622780024874941844495178742341131675818700155796280310646897103229083027529919187454771613414875490462993045875936234591157744167214046734190302287427367403568860249349359776931200150301621481939428066984857258770478004853926288162003818241246878159630318266155498887714140614580751646422502723648142074111613225912644502226694307736726087673647398291980857229829977354067820423709011783907277562489549103977052076140881547728240425069463175586173317054911517453708001448687312406872942899280723472709421452062317503252258181984837591194705354256671714708896675155493168030996749797654707148117051477506855802867089687545890519363621855230477269747205380531049996041867129632051572747028441506474146062043427303954298727328531350438208765938027973006421501568307421856483699068172998763428694958905673708416275143602068221058898394079378423785058886143156065469790907727616640696078658243794470631540358286862899496224884600294835441</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># e = 65537</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c = 445308155915029567991204642441037106636274278969323594266962964897048528466773947276913391974222302661172087064465526779062356615268434642959161607080766074334140739062421641878296527210809334178619685030176261525389226557543594953035919061416292966585184462770190073132725325830890587610808224156896611989260754435566640011008330800266408350415234832430226789140062590779004940578475055195767146347394381212157930691103929079825296986828415158506003438261121628407171546274414046568037336522095223978532053246031668840069046046390952201058199981492454288495640857942797704964843287034359460079316661425483842570190113998195387780579545809621808801626313837113473885818945052873823360056317079785841069224993435527933283918571286444280017102781865312454024328849395335083566145607543834607504822081522250923714391873652357185101163374950977150829214936039230387625706376713934778873385375582488086205462961139042991664546797362021066081938999660281537596860879414252495949608351649066648594254272314188241185715920283526637402373027396529855631498571685297193020517033784357794223831020791070397249992230576960345185544552280142788704673413055403847038488791910041421887897364099871208624646292906015164161354890370666964030412257423</span>
</span></span></code></pre></div><h2 id="challenge-analysis-1">Challenge Analysis<a href="#challenge-analysis-1" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>
<p>In sequel, the $seed$ is now 256 bits, which eliminates the approach in <code>RSA LCG 0</code>.</p>
</li>
<li>
<p>Let&rsquo;s look closer at the <code>get_prime</code> function. Denote $M = 2^{256}$ and $s_{i}$ as the $i$-th output of LCG, we have:
$$s_{i} = a^i * seed \pmod{M}$$</p>
</li>
<li>
<p>Therefore, each generated prime $p_j$ has the form
$$p_j = s_{i} * M^3 + s_{i + 1} * M^2 + s_{i + 2} * M + s_{i + 3}$$</p>
</li>
<li>
<p>Since all primes are generated from the same $seed$, we can express $n$ as follow:
$$n = p_0 * p_1 * p_2 * p_3$$
$$\displaylines{\Rightarrow n = (s_{i}       * M^3 + s_{i + 1}       * M^2 + s_{i + 2}       * M + s_{i + 3}) \\ *   (s_{i + k_0} * M^3 + s_{i + 1 + k_0} * M^2 + s_{i + 2 + k_0} * M + s_{i + 3 + k_0}) \\ *   (s_{i + k_1} * M^3 + s_{i + 1 + k_1} * M^2 + s_{i + 2 + k_1} * M + s_{i + 3 + k_1}) \\ *   (s_{i + k_2} * M^3 + s_{i + 1 + k_2} * M^2 + s_{i + 2 + k_2} * M + s_{i + 3 + k_2})}$$
where $k_0, k_1, k_2$ is the <strong>step diff</strong> between LCG outputs.</p>
</li>
<li>
<p>Since each loop in <code>get_prime</code> function require $1024 / 256 = 4$ outputs of LCG, all $k_i$ is divisible by 4</p>
</li>
<li>
<p>If we consider only 256 LSBs, we have:
$$n = s_{i + 3} * s_{i + 3 + k_0} * s_{i + 3 + k_1} * s_{i + 3 + k_2} \pmod{M}$$
$$\Rightarrow n = (a^{i + 3} * seed) * (a^{i + 3 + k_0} * seed) * (a^{i + 3 + k_1} * seed) * (a^{i + 3 + k_2} * seed) \pmod{M}$$
$$\Rightarrow n = a^{K} * seed^4 \pmod{M}$$</p>
</li>
<li>
<p>Local testing shows that $0 \leq K \leq 50000$ and $K$ is divisible by 4, so we can bruteforce values of K, then take $4$-th root modulo $M$ to calcualte <strong>candidate seeds</strong>.</p>
</li>
<li>
<p>To figure out the corrrect $seed$, an inappropriate approach may result in very long runtime. Here, we should notice that the result $seed$ might not be the starting seed, but maybe <strong>a very close one</strong> to the ones that create the prime. Hence, we might verify such seed by generate first 1024-bit number $p$ from the LCG with that seed and check if $p \mathrel{|} n$</p>
</li>
</ul>
<h2 id="solve-script-1">Solve Script<a href="#solve-script-1" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">102197201962123846389438942955101245465045811321520032783251514372432272871077</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">712650313276602240132329097304430048400352751513310575526412992129597422070848111072491134888258819603174150809317988369755331029009864211216547294646211646094933573124257136163629116984386416188859789467395164897001085191528084740453428500956450177548977865861466055171717564208692444769495508512419622780024874941844495178742341131675818700155796280310646897103229083027529919187454771613414875490462993045875936234591157744167214046734190302287427367403568860249349359776931200150301621481939428066984857258770478004853926288162003818241246878159630318266155498887714140614580751646422502723648142074111613225912644502226694307736726087673647398291980857229829977354067820423709011783907277562489549103977052076140881547728240425069463175586173317054911517453708001448687312406872942899280723472709421452062317503252258181984837591194705354256671714708896675155493168030996749797654707148117051477506855802867089687545890519363621855230477269747205380531049996041867129632051572747028441506474146062043427303954298727328531350438208765938027973006421501568307421856483699068172998763428694958905673708416275143602068221058898394079378423785058886143156065469790907727616640696078658243794470631540358286862899496224884600294835441</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">445308155915029567991204642441037106636274278969323594266962964897048528466773947276913391974222302661172087064465526779062356615268434642959161607080766074334140739062421641878296527210809334178619685030176261525389226557543594953035919061416292966585184462770190073132725325830890587610808224156896611989260754435566640011008330800266408350415234832430226789140062590779004940578475055195767146347394381212157930691103929079825296986828415158506003438261121628407171546274414046568037336522095223978532053246031668840069046046390952201058199981492454288495640857942797704964843287034359460079316661425483842570190113998195387780579545809621808801626313837113473885818945052873823360056317079785841069224993435527933283918571286444280017102781865312454024328849395335083566145607543834607504822081522250923714391873652357185101163374950977150829214936039230387625706376713934778873385375582488086205462961139042991664546797362021066081938999660281537596860879414252495949608351649066648594254272314188241185715920283526637402373027396529855631498571685297193020517033784357794223831020791070397249992230576960345185544552280142788704673413055403847038488791910041421887897364099871208624646292906015164161354890370666964030412257423</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a, c, seed<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_num</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>n_lsb <span style="color:#f92672">=</span> n <span style="color:#f92672">%</span> M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lcg <span style="color:#f92672">=</span> LCG(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>, a <span style="color:#f92672">=</span> a, c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">50000</span>, <span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">=</span> n_lsb <span style="color:#f92672">*</span> pow(a, <span style="color:#f92672">-</span>k, M) <span style="color:#f92672">%</span> M
</span></span><span style="display:flex;"><span>    candidates <span style="color:#f92672">=</span> Mod(seed, M)<span style="color:#f92672">.</span>nth_root(<span style="color:#ae81ff">4</span>, all <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> seed <span style="color:#f92672">in</span> candidates:
</span></span><span style="display:flex;"><span>        lcg<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> int(seed)
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> get_num(lcg, <span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> p <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>k <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        lcg<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> int(seed)
</span></span><span style="display:flex;"><span>        ps <span style="color:#f92672">=</span> [get_prime(lcg, bits<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> prod(ps) <span style="color:#f92672">!=</span> n:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        phi <span style="color:#f92672">=</span> prod(p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> ps)
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>        m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span><span style="display:flex;"><span>        print(long_to_bytes(int(m)))
</span></span><span style="display:flex;"><span>        exit()  
</span></span><span style="display:flex;"><span>            
</span></span></code></pre></div><p><code>FLAG: hkcert24{c0mpu71n9_subs3qu3nc3s_0f_g30m3tr1c_s3qu3nc3s_1s_fun}</code></p>
<h1 id="rsa-lcg-2">RSA LCG 2<a href="#rsa-lcg-2" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<h2 id="source-code-2">Source Code<a href="#source-code-2" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> reduce
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> operator <span style="color:#f92672">import</span> mul
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> secrets
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> isPrime <span style="color:#66d9ef">as</span> is_prime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, c<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, seed<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>seed <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(bits) <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(bits) <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>c <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>: self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> secrets<span style="color:#f92672">.</span>randbits(bits)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    FLAG <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environb<span style="color:#f92672">.</span>get(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;FLAG&#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;hkcert24{***REDACTED***}&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    lcg <span style="color:#f92672">=</span> LCG(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>, a<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>lcg <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ps <span style="color:#f92672">=</span> [get_prime(lcg, bits<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> reduce(mul, ps)
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x10001</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> int<span style="color:#f92672">.</span>from_bytes(FLAG, <span style="color:#e6db74">&#39;big&#39;</span>)
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> pow(m, e, n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>n <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>e <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>c <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># lcg = LCG(bits=256, a=1, c=14258939715516539295587731120991968901228171455016001595761489750577784177213)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># n = 279784521303926518544200383491171400996467006054806060652945044514173580730320793076951350168517896308345078513333979433742090849938580604359515861344088875721354836410510396140219655796215325682295239294661185563708496490830500773420871847769568879274978173218440545663363350310752698066412613793738234395676975963986090446949443295350235071286869321557833967521199446244573020803085515110891641843096725596572980675877230459500589604078432572911282759481893882548258867802789628543364574694501159808895930747113406016718685856976531978713324829507636743778130758650283045513372598798114943752532619142439604369129493324057181519512588183783756314385380800844831034863151900295735342816476791991454383732133474515109758087482912794282007801160780475284011802960270750792620686906175026995623082009841402872948756740311519047998978234628057595438481437871594714428834059691733188294695393205472914443179153321670750219104306769911019089432918102588905808629421158434486927928786793524017503900505368724824170796339023214910404096208544407500008089429770878575702088992309354303731919302687039737672125268143820658069899761163750521000478474705014645224845757836226858836333259628284972467671764606702417658922805838428375959908059533</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># e = 65537</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c = 12668023009781840908542456747150790958366008947388222673139950309896560492008423201703814113959062916216738813414905779255815616125482715748800637882572776464413794672305560913420843604427904075596817771292191713968187201485479797042112384390953800170012145372635694385419895184449315436204936393181245447065007450494691263361925589404791904565458416407877820052394996905208559706702586674504665164085593562932792149402776674399837342851449263354042894145700586851308674806581185881411576045932596814585050689676622481653401541955765009732517013919996864475158687111703292317464104677422251199063539026204584634157266215824371162154934075299210675220082034930924899581928745732959112210135371763739653442724659470938281648056607023621212384635978368358089470066114660978000389704285586405309891824263306072117253963803228130111794609335559502199299483268104278641029669532263556375348912538425414244341532656162870453118645106346455731193356791582571147804331894783849241501307040707035938949680381788534081674899875606974239354654393310878542209938345878740320797711262798440736790479007006147569066845667894663218494368548456732889916013895067014484182872120996578247736683746861794081478555452926231507488557048374863197550101866</span>
</span></span></code></pre></div><h2 id="challenge-analysis-2">Challenge Analysis<a href="#challenge-analysis-2" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>
<p>The setup of this challenge is pretty much the same as <code>RSA LCG 1</code>, except the fact that $a = 1$.</p>
</li>
<li>
<p>From version 2, we have the following formula for prime $p_j$ generated by LCG:
$$p_j = s_{i} * M^3 + s_{i + 1} * M^2 + s_{i + 2} * M + s_{i + 3}$$
$$\Rightarrow p_j = s_{i} * M^3 + (s_{i} + c - k0 * M) * M^2 + (s_{i} + 2 * c - k0 * M - k1 * M) * M + (s_{i} + 3 * c - k0 * M - k1 * M - k2 * M)$$</p>
</li>
<li>
<p>The $k_i$ are introduced to present the modular operation with $M$. Notice that while the M is <strong>256 bits</strong>, $c$ is only <strong>253 bits</strong>. This implies that the addition with $c$ in the LCG will rarely exceed $M$ $\Rightarrow$ At most $k_i$ is 1.</p>
</li>
<li>
<p>Since $s_i$ is only 256 bits and $n$ is 2048 bits, we should think of <strong>Coppersmith&rsquo;s Method</strong>. In fact, the equation $(?.?)$ should have a <strong>small root</strong> (256 bits) $s_i$. However, I tried Sage&rsquo;s <code>small_roots</code> with $\beta = 0.24$ but it did not give any solutions.</p>
</li>
<li>
<p>After hours of testing and blackboxing Coppersmith with <code>@kiona</code>&rsquo;s repo (I really need to study Coppersmith seriously &#x1f480;&#x1f480;&#x1f480;), I figured out that maybe the $\beta$ was too small compared to the bound of the root. Most of similar challenges that I attempted used $\beta \approx 0.48$, so at this point I think of 2 ways:</p>
<ol>
<li><strong>Bivariate Coppersmith + Bruteforce $k_i$:</strong> Since $n = p_0 * p_1 * p_2 * p_3$, I can treat $p_0$ and $p_1$ as 2 separate equations, then find small roots $(x, y)$ of equation $f = p_0 * p_1$. By constructing the equation this way, we can set $\beta = 0.48$.</li>
<li><strong>Univariate Coppersmith + Bruteforce $k_i$ + More Bruteforce:</strong> The idea is pretty much the same, but now I also have to take into consideration the difference $d$ between two LCG numbers (the number of loops require to generate new prime starting from old prime), also a new variable $K$ is introduced to cover the modulo $M$ when moving between states: $s_{i + 4 * d} = s_{i} + 4 * d * c - K * M$</li>
</ol>
</li>
<li>
<p>At some point, I gave up on the 1st approach and invested more time on the 2nd one. I tried to generate some params and discovering the reasonable range for $d$. Since $p_0$ and $p_1$ can be any factors of $n$, we just need to figure out the <em>smallest</em> $d$ between primes generated by LCG. I decided that $[0..1000]$ is a fine range for $d$, and $K \in [\frac{d}{2} - 8, \frac{d}{2}]$.</p>
</li>
<li>
<p>After recovering the $seed$, I moved LCG backward to ensure that the state is lower or equal to the starting state. Then I moved it forward to recover all the primes $ps$ and decrypt to get the flag</p>
</li>
<li>
<p>I am wondering if there is another way (LLL directly maybe) that requires less bruteforce and faster than my approach since it took 1-2 hours to run the script.</p>
</li>
</ul>
<h2 id="solve-script-2">Solve Script<a href="#solve-script-2" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, c<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, seed<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_num</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">14258939715516539295587731120991968901228171455016001595761489750577784177213</span>    
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">279784521303926518544200383491171400996467006054806060652945044514173580730320793076951350168517896308345078513333979433742090849938580604359515861344088875721354836410510396140219655796215325682295239294661185563708496490830500773420871847769568879274978173218440545663363350310752698066412613793738234395676975963986090446949443295350235071286869321557833967521199446244573020803085515110891641843096725596572980675877230459500589604078432572911282759481893882548258867802789628543364574694501159808895930747113406016718685856976531978713324829507636743778130758650283045513372598798114943752532619142439604369129493324057181519512588183783756314385380800844831034863151900295735342816476791991454383732133474515109758087482912794282007801160780475284011802960270750792620686906175026995623082009841402872948756740311519047998978234628057595438481437871594714428834059691733188294695393205472914443179153321670750219104306769911019089432918102588905808629421158434486927928786793524017503900505368724824170796339023214910404096208544407500008089429770878575702088992309354303731919302687039737672125268143820658069899761163750521000478474705014645224845757836226858836333259628284972467671764606702417658922805838428375959908059533</span>
</span></span><span style="display:flex;"><span>ct <span style="color:#f92672">=</span> <span style="color:#ae81ff">12668023009781840908542456747150790958366008947388222673139950309896560492008423201703814113959062916216738813414905779255815616125482715748800637882572776464413794672305560913420843604427904075596817771292191713968187201485479797042112384390953800170012145372635694385419895184449315436204936393181245447065007450494691263361925589404791904565458416407877820052394996905208559706702586674504665164085593562932792149402776674399837342851449263354042894145700586851308674806581185881411576045932596814585050689676622481653401541955765009732517013919996864475158687111703292317464104677422251199063539026204584634157266215824371162154934075299210675220082034930924899581928745732959112210135371763739653442724659470938281648056607023621212384635978368358089470066114660978000389704285586405309891824263306072117253963803228130111794609335559502199299483268104278641029669532263556375348912538425414244341532656162870453118645106346455731193356791582571147804331894783849241501307040707035938949680381788534081674899875606974239354654393310878542209938345878740320797711262798440736790479007006147569066845667894663218494368548456732889916013895067014484182872120996578247736683746861794081478555452926231507488557048374863197550101866</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>P <span style="color:#f92672">=</span> PolynomialRing(Zmod(n), <span style="color:#e6db74">&#39;x&#39;</span>)
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> P<span style="color:#f92672">.</span>gen(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>p01 <span style="color:#f92672">=</span> x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> k01, k02, k03 <span style="color:#f92672">in</span> [[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>]]:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>k01 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k02 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k03 <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    p02 <span style="color:#f92672">=</span> p01 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k01 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>    p03 <span style="color:#f92672">=</span> p02 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k02 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>    p04 <span style="color:#f92672">=</span> p03 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k03 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>    f1 <span style="color:#f92672">=</span> p04 <span style="color:#f92672">+</span> p03 <span style="color:#f92672">*</span> M <span style="color:#f92672">+</span> p02 <span style="color:#f92672">*</span> M <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> p01 <span style="color:#f92672">*</span> M <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> d <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> d <span style="color:#f92672">%</span> <span style="color:#ae81ff">50</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>d <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        p1 <span style="color:#f92672">=</span> p01 <span style="color:#f92672">+</span> d <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> c
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> K <span style="color:#f92672">in</span> range(d <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span> , d <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            p11 <span style="color:#f92672">=</span> p1 <span style="color:#f92672">-</span> K <span style="color:#f92672">*</span> M
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> k11, k12, k13 <span style="color:#f92672">in</span> [[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>]]:
</span></span><span style="display:flex;"><span>                p12 <span style="color:#f92672">=</span> p11 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k11 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>                p13 <span style="color:#f92672">=</span> p12 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k12 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>                p14 <span style="color:#f92672">=</span> p13 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k13 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>                f2 <span style="color:#f92672">=</span> p14 <span style="color:#f92672">+</span> p13 <span style="color:#f92672">*</span> M <span style="color:#f92672">+</span> p12 <span style="color:#f92672">*</span> M <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> p11 <span style="color:#f92672">*</span> M <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>                f <span style="color:#f92672">=</span> f1 <span style="color:#f92672">*</span> f2
</span></span><span style="display:flex;"><span>                seeds <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>monic()<span style="color:#f92672">.</span>small_roots(X <span style="color:#f92672">=</span> M, beta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.48</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> seeds <span style="color:#f92672">==</span> []:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>k01 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k02 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k03 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>d <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>K <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k11 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k12 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k13 <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>seeds <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>                seed <span style="color:#f92672">=</span> (int(seeds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">-</span> <span style="color:#ae81ff">4001</span> <span style="color:#f92672">*</span> c) <span style="color:#f92672">%</span> M
</span></span><span style="display:flex;"><span>                lcg <span style="color:#f92672">=</span> LCG(bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span>, a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, c <span style="color:#f92672">=</span> c, seed <span style="color:#f92672">=</span> seed)
</span></span><span style="display:flex;"><span>                ps <span style="color:#f92672">=</span> [get_num(lcg, <span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8000</span>)]
</span></span><span style="display:flex;"><span>                ps <span style="color:#f92672">=</span> [p <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> ps <span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> p <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>                print(len(ps))
</span></span><span style="display:flex;"><span>                phi <span style="color:#f92672">=</span> prod([p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> ps])
</span></span><span style="display:flex;"><span>                seeds <span style="color:#f92672">=</span> pow(<span style="color:#ae81ff">65537</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>                m <span style="color:#f92672">=</span> pow(ct, seeds, n)
</span></span><span style="display:flex;"><span>                print(long_to_bytes(int(m)))
</span></span><span style="display:flex;"><span>                exit()
</span></span></code></pre></div><p><code>FLAG: hkcert24{surpr1s3_lll4t71c3_r3duc710n_t1m3}</code></p>
<h1 id="rsa-lcg-3">RSA LCG 3<a href="#rsa-lcg-3" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<h2 id="source-code-3">Source Code<a href="#source-code-3" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h2 id="challenge-analysis-3">Challenge Analysis<a href="#challenge-analysis-3" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h2 id="solve-script-3">Solve Script<a href="#solve-script-3" class="hanchor" ariaLabel="Anchor">#</a> </h2>

      </div></div>
</div>
  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read other posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
    
    
      <a href="http://localhost:1313/posts/2024/2024-10-26-isitdtu-quals/" class="button inline next">
        ISITDTU Quals 2024 Writeup
      </a>
    
  </div>
</div>


  

  
    

  
</article>

<style>
	.table-of-contents {
    position: fixed;
    top: 20px;  
    left: 0;  
    width: 250px;  
    margin-left: 50px;  
    box-sizing: border-box;  
    padding: 10px;  
	font-size: 10px;
  }
</style>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Â© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script>
<script>
	MathJax = {










		tex: {
			inlineMath: [['$', '$'], ['\\(', '\\)']],
			displayMath: [['$$', '$$'], ['\\[', '\\]']],
			
		}
	};
</script>



  
</div>

</body>
</html>
