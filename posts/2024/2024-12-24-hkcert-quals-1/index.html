<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>HKCERT CTF Quals 2024 Writeup (Part 1) :: Zayn</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Writeup for crypto challenges in HKCERT CTF Quals 2024 - `RSA LCG` Series" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/posts/2024/2024-12-24-hkcert-quals-1/" />


  





  
  <link rel="stylesheet" href="http://localhost:1313/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/main.min.fe8dc560fccb53a458b0db19ccb7b265764ac46b68596b7e099c6793054dd457.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/post.min.fc74ca360273c1d828da3c02b8174eba435607b369d98418ccc6f2243cd4e75d.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terminal.min.34d0b0e02c268ed4dc358b889f73fc70d0bd6561b4fba53a7cf62f4b3c239fca.css">

  
  <link rel="stylesheet" href="http://localhost:1313/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="http://localhost:1313/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="HKCERT CTF Quals 2024 Writeup (Part 1)">
<meta property="og:description" content="Writeup for crypto challenges in HKCERT CTF Quals 2024 - `RSA LCG` Series" />
<meta property="og:url" content="http://localhost:1313/posts/2024/2024-12-24-hkcert-quals-1/" />
<meta property="og:site_name" content="Zayn" />

  
  
    
  
  <meta property="og:image" content="http://localhost:1313/posts/2024/2024-12-24-hkcert-quals-1/hkcert2024.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2024-12-24 00:00:00 &#43;0000 UTC" />












</head>
<body>


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Zayn
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;â–¾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="/showcase" >Showcase</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/posts/2024/2024-12-24-hkcert-quals-1/">HKCERT CTF Quals 2024 Writeup (Part 1)</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-12-24</time><span class="post-author">Zayn</span></div>

  
  
  <img src="/posts/2024/2024-12-24-hkcert-quals-1/hkcert2024.png"
    class="post-cover"
    alt="HKCERT CTF Quals 2024 Writeup (Part 1)"
    title="Cover Image" />

  <div class="post-container">
  

  <div class="post-content"><div>
        <p>This is the first time I play HKCERT CTF. Honestly, I&rsquo;ve been waiting for this occasion for so long since one of the crypto authors is my favorite - <code>@Mystiz</code>. Eventually, I solved 9/10 challenges. In this part, I&rsquo;ll present the solution for the <code>RSA LCG</code> series: <code>RSA LCG 0</code>, <code>RSA LCG 1</code>, <code>RSA LCG 2</code>, and <code>RSA LCG 3</code>.</p>
<h1 id="rsa-lcg-0">RSA LCG 0<a href="#rsa-lcg-0" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<h2 id="challenge-analysis">Challenge Analysis<a href="#challenge-analysis" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>Among this series, the flag is encrypted with RSA. However the primes used by RSA are generated by a Linear Congruential Generator (LCG) with 4 parameters $a, c, M, seed$. The state of LCG is updated as follow:
$$seed = a * seed + c \pmod{M}$$</li>
<li>In this challenge, we are given 3 parameters of the LCG: $a, c, M$. We also know that $seed$ is a 16-bit odd integer.</li>
<li>Since the range of $seed$ is pretty small, we can enumerate through all possible values of the seed, then generate the first prime $p$ and check if $p \mathrel{|} n$</li>
</ul>
<h2 id="solve-script">Solve Script<a href="#solve-script" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> isPrime <span style="color:#66d9ef">as</span> is_prime
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> prod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a, c, seed):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_num</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lcg <span style="color:#f92672">=</span> LCG(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">128</span>, a<span style="color:#f92672">=</span><span style="color:#ae81ff">181525535962623036141846439269075744717</span>, c<span style="color:#f92672">=</span><span style="color:#ae81ff">115518761677956575882056543847720910703</span>, seed<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">481114791694785858695050549695538734046971417176843978882044871919616727765643820034066591387776993303130591599679964348353329376559922076715381691496791199317834852972956556186543750873476577029492255903246050392214315442941266567737558736141253495436298490003513325026207840446389886295321748490024615821174562383476857761918630446488869812894422048853097952363719756297344014883459670109643440173428469002028435568608888993928248402297380061528970024946401518041243564217741744613525402813984605478699738311132717493610790718032712239270654974446116711995328572373804563487208899590643981315012517538379075118546604524143430683964513429268368997878214614073305169449253802788601323508855536854500946367628892634824935231007194546528797696281628426050519984306590514055620223093615738335974270220301535497863462980632453977776013292134758089648072661829571370276168813518517058289217357255320627263734650032320305279867840420886394855960116879598125383109784504746667833173574005936871719063288584361794901458463052848937392072728849939635133710409996428462876274835371522565826839423046726308001047859782566419852401917763502007196004524754115471117969452116174478677547559057917128250716516531170082878464757039874318490906158689</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">345977789156696385683581168846000378215844867611205467179181525756923773343997491856273352579925123046597359189866939437231366570263052567113535467666353517443555775669947203980735918360811410985879753948221470545729133552842244535778330182549296248222039054438197983267418429814674564210947108838042963108251861548375535326969960093796185009763176002544709169063466256285182205803310470811843866647483609768051301160908646352263376778439044867189801653416628219979460525679135210530110143121851284249580066642389243748128010268277263972367956550837364650977683324140767090284085773301486622501777068017859676285398384937589784505599555747372780238872296757407155242584567297352399943303106161556729208284654934208601533197169169514879515899747537955886064112109885660797961038075757520138954391314283382301755474526387505278386817416193439304304484679228240909612236945218009947246430065957288065358434877715856330476675541582153869420244176864467086961698529560004535449279996657026744930241841052475481816491735959706500890907139027990119800255632071177694111432383236909734940374926954075681464953536382583119130818187839809617068848876572944726598351264384270260481762978383770917542259594389267566490962365207501538561114532291</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> seed <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> seed <span style="color:#f92672">%</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>seed <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>	lcg<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>	p <span style="color:#f92672">=</span> get_prime(lcg, <span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> p <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Found </span><span style="color:#e6db74">{</span>seed <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lcg<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>ps <span style="color:#f92672">=</span> [get_prime(lcg, <span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>phi <span style="color:#f92672">=</span> prod([p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> ps])
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span><span style="display:flex;"><span>print(long_to_bytes(m))
</span></span></code></pre></div><p><code>FLAG: hkcert24{0k4y_th1s_1s_n0t_ev3n_vu1n3r4b1e_b3c4u5e_0f_1cgs}</code></p>
<h1 id="rsa-lcg-1">RSA LCG 1<a href="#rsa-lcg-1" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<h2 id="challenge-analysis-1">Challenge Analysis<a href="#challenge-analysis-1" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>In sequel, the $seed$ is now 256 bits, which eliminates the approach in <code>RSA LCG 0</code>. A notable point here is that $c = 0$.</li>
</ul>
<h2 id="solution">Solution<a href="#solution" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>Denote $s_{i}$ as the $i$-th output of LCG, we have:
$$s_{i} = a^i * seed \pmod{M}$$</li>
<li>Each prime $p_j$ generated by <code>get_prime</code> function has the form:
$$p_j = s_{i} * M^3 + s_{i + 1} * M^2 + s_{i + 2} * M + s_{i + 3}$$</li>
<li>Since all primes are generated from the same $seed$, we can express $n$ as follow:
$$n = p_0 * p_1 * p_2 * p_3$$
$$\displaylines{\Rightarrow n = (s_{i}       * M^3 + s_{i + 1}       * M^2 + s_{i + 2}       * M + s_{i + 3}) \\ *   (s_{i + k_0} * M^3 + s_{i + 1 + k_0} * M^2 + s_{i + 2 + k_0} * M + s_{i + 3 + k_0}) \\ *   (s_{i + k_1} * M^3 + s_{i + 1 + k_1} * M^2 + s_{i + 2 + k_1} * M + s_{i + 3 + k_1}) \\ *   (s_{i + k_2} * M^3 + s_{i + 1 + k_2} * M^2 + s_{i + 2 + k_2} * M + s_{i + 3 + k_2})} (1)$$
where $k_0, k_1, k_2$ are the <strong>step diff</strong> between LCG outputs.</li>
<li>If we reduce $(1)$ modulo $M$, we have:
$$n = s_{i + 3} * s_{i + 3 + k_0} * s_{i + 3 + k_1} * s_{i + 3 + k_2} \pmod{M}$$
$$\Rightarrow n = (a^{i + 3} * seed) * (a^{i + 3 + k_0} * seed) * (a^{i + 3 + k_1} * seed) * (a^{i + 3 + k_2} * seed) \pmod{M}$$
$$\Rightarrow n = a^{K} * seed^4 \pmod{M}$$
where $K = 4 * i +12 + k_0 + k_1 + k_2$</li>
<li>Since each loop in <code>get_prime</code> function require $1024 / 256 = 4$ outputs of LCG, all $k_i$ is divisible by 4, this implies that $K$ is also divisible by 4. If we can find $K$, then we can recover the seed by taking $4$-th root modulo $M$.</li>
<li>As this is LCG, every state $s_i$ is actually a <strong>valid</strong> seed. I don&rsquo;t need the original seed $s_0$  but the one that creates the first prime after 4 LCG&rsquo;s outputs. Local testing shows that in this case bruteforcing $K \in [0, 5000]$ is sufficient. We can verify the $seed$ by using it to generate the first 1024-bit number $p$ from the LCG and check if $p \mathrel{|} n$.</li>
</ul>
<h2 id="solve-script-1">Solve Script<a href="#solve-script-1" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">102197201962123846389438942955101245465045811321520032783251514372432272871077</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">712650313276602240132329097304430048400352751513310575526412992129597422070848111072491134888258819603174150809317988369755331029009864211216547294646211646094933573124257136163629116984386416188859789467395164897001085191528084740453428500956450177548977865861466055171717564208692444769495508512419622780024874941844495178742341131675818700155796280310646897103229083027529919187454771613414875490462993045875936234591157744167214046734190302287427367403568860249349359776931200150301621481939428066984857258770478004853926288162003818241246878159630318266155498887714140614580751646422502723648142074111613225912644502226694307736726087673647398291980857229829977354067820423709011783907277562489549103977052076140881547728240425069463175586173317054911517453708001448687312406872942899280723472709421452062317503252258181984837591194705354256671714708896675155493168030996749797654707148117051477506855802867089687545890519363621855230477269747205380531049996041867129632051572747028441506474146062043427303954298727328531350438208765938027973006421501568307421856483699068172998763428694958905673708416275143602068221058898394079378423785058886143156065469790907727616640696078658243794470631540358286862899496224884600294835441</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">445308155915029567991204642441037106636274278969323594266962964897048528466773947276913391974222302661172087064465526779062356615268434642959161607080766074334140739062421641878296527210809334178619685030176261525389226557543594953035919061416292966585184462770190073132725325830890587610808224156896611989260754435566640011008330800266408350415234832430226789140062590779004940578475055195767146347394381212157930691103929079825296986828415158506003438261121628407171546274414046568037336522095223978532053246031668840069046046390952201058199981492454288495640857942797704964843287034359460079316661425483842570190113998195387780579545809621808801626313837113473885818945052873823360056317079785841069224993435527933283918571286444280017102781865312454024328849395335083566145607543834607504822081522250923714391873652357185101163374950977150829214936039230387625706376713934778873385375582488086205462961139042991664546797362021066081938999660281537596860879414252495949608351649066648594254272314188241185715920283526637402373027396529855631498571685297193020517033784357794223831020791070397249992230576960345185544552280142788704673413055403847038488791910041421887897364099871208624646292906015164161354890370666964030412257423</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a, c, seed<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_num</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>n_lsb <span style="color:#f92672">=</span> n <span style="color:#f92672">%</span> M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lcg <span style="color:#f92672">=</span> LCG(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>, a <span style="color:#f92672">=</span> a, c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">50000</span>, <span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">=</span> n_lsb <span style="color:#f92672">*</span> pow(a, <span style="color:#f92672">-</span>k, M) <span style="color:#f92672">%</span> M
</span></span><span style="display:flex;"><span>    candidates <span style="color:#f92672">=</span> Mod(seed, M)<span style="color:#f92672">.</span>nth_root(<span style="color:#ae81ff">4</span>, all <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> seed <span style="color:#f92672">in</span> candidates:
</span></span><span style="display:flex;"><span>        lcg<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> int(seed)
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> get_num(lcg, <span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> p <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>k <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        lcg<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> int(seed)
</span></span><span style="display:flex;"><span>        ps <span style="color:#f92672">=</span> [get_prime(lcg, bits<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> prod(ps) <span style="color:#f92672">!=</span> n:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        phi <span style="color:#f92672">=</span> prod(p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> ps)
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>        m <span style="color:#f92672">=</span> pow(c, d, n)
</span></span><span style="display:flex;"><span>        print(long_to_bytes(int(m)))
</span></span><span style="display:flex;"><span>        exit()  
</span></span><span style="display:flex;"><span>            
</span></span></code></pre></div><p><code>FLAG: hkcert24{c0mpu71n9_subs3qu3nc3s_0f_g30m3tr1c_s3qu3nc3s_1s_fun}</code></p>
<h1 id="rsa-lcg-2">RSA LCG 2<a href="#rsa-lcg-2" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<h2 id="challenge-analysis-2">Challenge Analysis<a href="#challenge-analysis-2" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>The setup of this challenge is pretty much the same as <code>RSA LCG 1</code>, except the fact that $a = 1$ and $c$ is randomly generated.</li>
</ul>
<h2 id="solution-1">Solution<a href="#solution-1" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>Denote $s_{i}$ as the $i$-th output of LCG, we have:
$$s_{i} = seed + i * c \pmod{M}$$</li>
<li>From <code>RSA LCG 1</code>, we have the following formula for prime $p_j$ generated by LCG:
$$p_0 = s_{i} * M^3 + s_{i + 1} * M^2 + s_{i + 2} * M + s_{i + 3}$$
$$\displaylines{\Rightarrow p_0 = s_{i} * M^3 + (s_{i} + c - k_0 * M) * M^2 + \\ (s_{i} + 2 * c - k_0 * M - k_1 * M) * M + \\ (s_{i} + 3 * c - k_0 * M - k_1 * M - k_2 * M)}$$</li>
<li>The $k_i$ are introduced to present the modular operation with $M$. Notice that while $M$ is <strong>256 bits</strong>, $c$ is only <strong>253 bits</strong>. This implies that the addition with $c$ in the LCG will rarely exceed $M$ $\Rightarrow k_i \in [0, 1]$.</li>
<li>Since $s_i$ is only 256 bits and $n$ is 2048 bits, we should think of <strong>Coppersmith&rsquo;s Method</strong>. In fact, the polynomial $f = p_0 * p_1 * p_2 * p_3 - n$ should have a <strong>small root</strong> $s_i$ (256 bits). I tried Sage&rsquo;s <code>small_roots</code> with $\beta = 0.245$ but it did not give any solutions.</li>
<li>After the CTF ends, I spent some time reading about Coppersmith&rsquo;s method and stumbled upon the Theorem 1.5<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>:</li>
</ul>
<blockquote>
<p><strong>Theorem 1.5:</strong> <em>Let $N$ be an integer of unknown factorization, which has a divisor $b \leq N^{\beta}, 0 &lt; \beta \leq 1$. Let $c \leq 1$ ,and let $f (x)$ be a univariate monic polynomial of constant degree $\delta$. Then we can find all solutions $x_0$ of the equation</em>
$$f(x) = 0 \pmod{b} \textit{ with } |x_0| \leq cN^{\frac{\beta^2}{\delta}}$$</p>
</blockquote>
<ul>
<li>In this situation, we need to find a 256-bit root $s_i$ with $\beta = 0.245$, which does not satisfy the condition of stated theorem.</li>
<li>Therefore, I need to find a polynomial $f$ such that $f(s_i) = 0 \pmod{p_ip_j}$, which allows me to set $\beta = 0.48$ - eventually satisfies the theorem&rsquo;s condition.</li>
<li>I tried to adopt the idea from <code>RSA LCG 1</code>, i.e. expressing $p_j$ in terms of $p_i$. With this way, I introduce 2 new variables: $d$ - difference between two LCG outputs (the number of loops require to generate new prime starting from old prime), and $K$ - cover the modulo $M$ when moving between states:
$$s_{i + 4 * d} = s_{i} + 4 * d * c - K * M$$</li>
<li>Since $p_i$ and $p_j$ can be any factors of $n$, we just need to figure out the <em>smallest</em> $d$ between 2 factors of $n$. At the end, I found that $d \in [0, 1000]$ and $K \in [\frac{d}{2} - 8, \frac{d}{2}]$ is enough.</li>
<li>Note that I also need to brute force 6 $k_i$ of $p_0$ and $p_1$ to correctly construct the polynomial $f$.</li>
<li>After recovering $s_i$, I moved LCG backward to ensure that the state is lower or equal to the starting state. Then I moved it forward to recover all the primes $ps$ and perform RSA decryption get the flag.</li>
</ul>
<h2 id="solve-script-2">Solve Script<a href="#solve-script-2" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> long_to_bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, c<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, seed<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_num</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">14258939715516539295587731120991968901228171455016001595761489750577784177213</span>    
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">279784521303926518544200383491171400996467006054806060652945044514173580730320793076951350168517896308345078513333979433742090849938580604359515861344088875721354836410510396140219655796215325682295239294661185563708496490830500773420871847769568879274978173218440545663363350310752698066412613793738234395676975963986090446949443295350235071286869321557833967521199446244573020803085515110891641843096725596572980675877230459500589604078432572911282759481893882548258867802789628543364574694501159808895930747113406016718685856976531978713324829507636743778130758650283045513372598798114943752532619142439604369129493324057181519512588183783756314385380800844831034863151900295735342816476791991454383732133474515109758087482912794282007801160780475284011802960270750792620686906175026995623082009841402872948756740311519047998978234628057595438481437871594714428834059691733188294695393205472914443179153321670750219104306769911019089432918102588905808629421158434486927928786793524017503900505368724824170796339023214910404096208544407500008089429770878575702088992309354303731919302687039737672125268143820658069899761163750521000478474705014645224845757836226858836333259628284972467671764606702417658922805838428375959908059533</span>
</span></span><span style="display:flex;"><span>ct <span style="color:#f92672">=</span> <span style="color:#ae81ff">12668023009781840908542456747150790958366008947388222673139950309896560492008423201703814113959062916216738813414905779255815616125482715748800637882572776464413794672305560913420843604427904075596817771292191713968187201485479797042112384390953800170012145372635694385419895184449315436204936393181245447065007450494691263361925589404791904565458416407877820052394996905208559706702586674504665164085593562932792149402776674399837342851449263354042894145700586851308674806581185881411576045932596814585050689676622481653401541955765009732517013919996864475158687111703292317464104677422251199063539026204584634157266215824371162154934075299210675220082034930924899581928745732959112210135371763739653442724659470938281648056607023621212384635978368358089470066114660978000389704285586405309891824263306072117253963803228130111794609335559502199299483268104278641029669532263556375348912538425414244341532656162870453118645106346455731193356791582571147804331894783849241501307040707035938949680381788534081674899875606974239354654393310878542209938345878740320797711262798440736790479007006147569066845667894663218494368548456732889916013895067014484182872120996578247736683746861794081478555452926231507488557048374863197550101866</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>P <span style="color:#f92672">=</span> PolynomialRing(Zmod(n), <span style="color:#e6db74">&#39;x&#39;</span>)
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> P<span style="color:#f92672">.</span>gen(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>p01 <span style="color:#f92672">=</span> x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> k01, k02, k03 <span style="color:#f92672">in</span> [[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>]]:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>k01 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k02 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k03 <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    p02 <span style="color:#f92672">=</span> p01 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k01 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>    p03 <span style="color:#f92672">=</span> p02 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k02 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>    p04 <span style="color:#f92672">=</span> p03 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k03 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>    f1 <span style="color:#f92672">=</span> p04 <span style="color:#f92672">+</span> p03 <span style="color:#f92672">*</span> M <span style="color:#f92672">+</span> p02 <span style="color:#f92672">*</span> M <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> p01 <span style="color:#f92672">*</span> M <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> d <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> d <span style="color:#f92672">%</span> <span style="color:#ae81ff">50</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>d <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        p1 <span style="color:#f92672">=</span> p01 <span style="color:#f92672">+</span> d <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> c
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> K <span style="color:#f92672">in</span> range(d <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">8</span> , d <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            p11 <span style="color:#f92672">=</span> p1 <span style="color:#f92672">-</span> K <span style="color:#f92672">*</span> M
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> k11, k12, k13 <span style="color:#f92672">in</span> [[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>]]:
</span></span><span style="display:flex;"><span>                p12 <span style="color:#f92672">=</span> p11 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k11 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>                p13 <span style="color:#f92672">=</span> p12 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k12 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>                p14 <span style="color:#f92672">=</span> p13 <span style="color:#f92672">+</span> c <span style="color:#f92672">-</span> k13 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>                f2 <span style="color:#f92672">=</span> p14 <span style="color:#f92672">+</span> p13 <span style="color:#f92672">*</span> M <span style="color:#f92672">+</span> p12 <span style="color:#f92672">*</span> M <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> p11 <span style="color:#f92672">*</span> M <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>                f <span style="color:#f92672">=</span> f1 <span style="color:#f92672">*</span> f2
</span></span><span style="display:flex;"><span>                seeds <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>monic()<span style="color:#f92672">.</span>small_roots(X <span style="color:#f92672">=</span> M, beta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.48</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> seeds <span style="color:#f92672">==</span> []:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>k01 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k02 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k03 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k11 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k12 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>k13 <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>d <span style="color:#e6db74">= }</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>K <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>seeds <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>                seed <span style="color:#f92672">=</span> (int(seeds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">-</span> <span style="color:#ae81ff">4001</span> <span style="color:#f92672">*</span> c) <span style="color:#f92672">%</span> M
</span></span><span style="display:flex;"><span>                lcg <span style="color:#f92672">=</span> LCG(bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span>, a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, c <span style="color:#f92672">=</span> c, seed <span style="color:#f92672">=</span> seed)
</span></span><span style="display:flex;"><span>                ps <span style="color:#f92672">=</span> [get_num(lcg, <span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8000</span>)]
</span></span><span style="display:flex;"><span>                ps <span style="color:#f92672">=</span> [p <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> ps <span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> p <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>                phi <span style="color:#f92672">=</span> prod([p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> ps])
</span></span><span style="display:flex;"><span>                seeds <span style="color:#f92672">=</span> pow(<span style="color:#ae81ff">65537</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>                m <span style="color:#f92672">=</span> pow(ct, seeds, n)
</span></span><span style="display:flex;"><span>                print(long_to_bytes(int(m)))
</span></span><span style="display:flex;"><span>                exit()
</span></span></code></pre></div><p><code>FLAG: hkcert24{surpr1s3_lll4t71c3_r3duc710n_t1m3}</code></p>
<h1 id="rsa-lcg-3">RSA LCG 3<a href="#rsa-lcg-3" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<h2 id="challenge-analysis-3">Challenge Analysis<a href="#challenge-analysis-3" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>In this challenge, we are given 128 LSBs of $seed$ in addition to $a$, $c$ and $M$ - which all have 256 bits.</li>
</ul>
<h2 id="solution-2">Solution<a href="#solution-2" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>As taking $k$ LSBs of a number $n$ is equivalent to reduce $n$ modulo $2^k$, besides the fact the modulus $M$ is an exponent of 2, the knowledge of $seed$&rsquo;s LSBs allows me to &ldquo;almost&rdquo; know the LSBs of $p_i$&rsquo;s LSBs</li>
<li>Why &ldquo;almost&rdquo;? Because I can generate 5000 1024-bit numbers (again, the number 5000 comes from my local testing)  from the LCG with $seed = 1$ and take their LSBs. The primes&rsquo; LSBs are guaranteed to be found in those numbers. But how do I find the correct ones?</li>
<li>Taking the idea from <code>RSA LCG 1</code>, we have:
$$n = p_0 * p_1 * p_2 * p_3 \pmod{2^{128}}$$
$$\Rightarrow n = s_{i + 3} * s_{i + 3 + k_0} * s_{i + 3 + k_1} * s_{i + 3 + k_2} \pmod{2^{128}}$$ where $s_{i}$ is the $i$-th output of LCG.</li>
<li>By using meet-in-the-middle, we can find all $p_i$&rsquo;s LSBs and $k_i$. Then, we define the polynomial $$f = s_{i + 3} * s_{i + 3 + k_0} * s_{i + 3 + k_1} * s_{i + 3 + k_2} - n$$ and solve $f = 0 \pmod{2^{256}}$ to obtain the $seed$. The rest is trivial.</li>
</ul>
<h2 id="solve-script-3">Solve Script<a href="#solve-script-3" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> isPrime <span style="color:#66d9ef">as</span> is_prime, long_to_bytes
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> itertools <span style="color:#f92672">import</span> combinations
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG_Mod</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, c<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, seed<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>counter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LCG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, bits, a<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, c<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, seed<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>a <span style="color:#f92672">=</span> a
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>c <span style="color:#f92672">=</span> c
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>bits <span style="color:#f92672">=</span> bits
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>m <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>bits
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>seed <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>a <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>c) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>seed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __repr__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;LCG(bits=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>bits<span style="color:#e6db74">}</span><span style="color:#e6db74">, a=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, c=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_prime</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> p<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">!=</span> bits: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_prime(p): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_num</span>(lcg, bits):
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(bits<span style="color:#f92672">//</span>lcg<span style="color:#f92672">.</span>bits):
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">&lt;&lt;=</span> lcg<span style="color:#f92672">.</span>bits
</span></span><span style="display:flex;"><span>        p <span style="color:#f92672">|=</span> lcg<span style="color:#f92672">.</span>next()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">310104949044058363811425892282439667555795850923698164575500719920877363952490328278993741848588550303907803963138208625777769116407165079299045658359072735954939955634899149028890186203432587177185672614983999894171325785452784795686085757918290966774324125319406224747711723917236527562556229579589022628862590296281590323788478820477333016394079937231878378358046269624402362566235154381484471820688582120004595351405438024178098190005187895688879764539037795309008703147966413618274215850034115978270168263624156747737483336047033398686990065931568589053366201551840168657333564635190953575770912434947264202860664609208924668470174089395139643640441218757659152083626042918967413234744394606549606305861281752161107561439760204185976944782327736965087510398008449771008025699947582049442588729371212204993669594933838721600502189158688622194652824336960901728311819450912079584032482610919375366829986623070788751982011540521220055895553821778224253746970625666841786339189340344498152279172317609743104777470108401770109956350920020610131660906732383196598286142112787914912796448301345111823730145040316068582039211121377301361760688564938322941885358577303167411970251703604232966219027983536858119778300500933101751641899457</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>ct <span style="color:#f92672">=</span> <span style="color:#ae81ff">103062216319994633883021726707255505833894115982244229797744500400724941059411346264133479322957473182662752018633592486294774530211270693527482730004815628242002327808204776228223444383519632042858531074466552102288702530352869324049976713089889252600765238196110451324303956172732401402047005544975223308718486936799382134071405038584109821524691964342940757473561547043393942877521141027936710682878315017107714350048208655766169663561363722598270709129397838087810818396682268983758680728353233325680608113581239966748966828100455121487936700949018790286804701500925964419202040562160087415752569883786048654250026952720505649274955681447219364518875892085854376617187428517680579374255991868541726338897567149638047885985817814723274557132684796698662679779677729590702208805883768828626340945484760552452520907126473183457061321026569739763527385628295340908066618403473190885048961117252304808518351740671498261396384433967551138018727839531240932197016466713851341150888734655103395641340466366445201973820121462512449662479632578237405866465926851495594436176622348441495580476338358402531879195673909374090632193981789951544889982768669254824649367936539308980191669227919352771464458152027996758074065744620552247585183945</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">14766004292360945258404852367497617471774948936126805425073927394403062559771</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">101392444572529008969348961056906071660419768871029068095780498478077435335658</span>
</span></span><span style="display:flex;"><span>lcg <span style="color:#f92672">=</span> LCG(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>, a <span style="color:#f92672">=</span> a, c <span style="color:#f92672">=</span> c, seed <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">128</span>
</span></span><span style="display:flex;"><span>n_lsb <span style="color:#f92672">=</span> n <span style="color:#f92672">%</span> MOD
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>K <span style="color:#f92672">=</span> Zmod(<span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>)
</span></span><span style="display:flex;"><span>P <span style="color:#f92672">=</span> PolynomialRing(K, <span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> P<span style="color:#f92672">.</span>gens()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>lcg_mod <span style="color:#f92672">=</span> LCG_Mod(bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span>, a <span style="color:#f92672">=</span> K(a), c <span style="color:#f92672">=</span> K(c), seed <span style="color:#f92672">=</span> x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>ps <span style="color:#f92672">=</span> [get_num(lcg, bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>) <span style="color:#f92672">%</span> MOD <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(SIZE)]
</span></span><span style="display:flex;"><span>lookup <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, j <span style="color:#f92672">in</span> combinations(range(SIZE), <span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>    lookup[(ps[i] <span style="color:#f92672">*</span> ps[j]) <span style="color:#f92672">%</span> MOD] <span style="color:#f92672">=</span> (i, j)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Done generating lookup table&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, j <span style="color:#f92672">in</span> combinations(range(SIZE), <span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>    t <span style="color:#f92672">=</span> (n_lsb <span style="color:#f92672">*</span> pow(ps[i] <span style="color:#f92672">*</span> ps[j], <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, MOD)) <span style="color:#f92672">%</span> MOD
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> t <span style="color:#f92672">in</span> lookup:
</span></span><span style="display:flex;"><span>        ks <span style="color:#f92672">=</span> sorted([<span style="color:#f92672">*</span>lookup[t], i, j])
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>ks <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ks <span style="color:#f92672">=</span> [(x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> ks]
</span></span><span style="display:flex;"><span>ps_symbol <span style="color:#f92672">=</span> [lcg_mod<span style="color:#f92672">.</span>next() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(max(ks) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>P1, P2, P3, P4 <span style="color:#f92672">=</span> [ps_symbol[k] <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> ks]
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> P1 <span style="color:#f92672">*</span> P2 <span style="color:#f92672">*</span> P3 <span style="color:#f92672">*</span> P4 <span style="color:#f92672">-</span> n <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>change_ring(Zp(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">256</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>seeds <span style="color:#f92672">=</span> [ZZ(p) <span style="color:#66d9ef">for</span> p, _ <span style="color:#f92672">in</span> f<span style="color:#f92672">.</span>roots()]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> seed <span style="color:#f92672">in</span> seeds:
</span></span><span style="display:flex;"><span>    lcg<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> int(seed)
</span></span><span style="display:flex;"><span>    ps <span style="color:#f92672">=</span> [get_prime(lcg, bits<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> prod(ps) <span style="color:#f92672">!=</span> n:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>seed <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    phi <span style="color:#f92672">=</span> prod([p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> ps])
</span></span><span style="display:flex;"><span>    d <span style="color:#f92672">=</span> pow(e, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, phi)
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> pow(ct, d, n)
</span></span><span style="display:flex;"><span>    print(long_to_bytes(int(m)))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><p><code>FLAG: hkcert24{i5_th1s_y3t_4n0th3r_l33tc0d3_f0ur_sum_qu3s71on?}</code></p>
<hr>
<hr>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Herrmann, M., &amp; May, A. (2010). Maximizing small root bounds by linearization and applications to small secret exponent RSA. In Public Key Cryptographyâ€“PKC 2010: 13th International Conference on Practice and Theory in Public Key Cryptography, Paris, France, May 26-28, 2010. Proceedings 13 (pp. 53-69). Springer Berlin Heidelberg.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

      </div></div>
</div>
  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read other posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
    
    
      <a href="http://localhost:1313/posts/2024/2024-12-23-hkcert-quals-2/" class="button inline next">
        HKCERT CTF Quals 2024 Writeup (Part 2)
      </a>
    
  </div>
</div>


  

  
    

  
</article>

<style>
	.table-of-contents {
    position: fixed;
    top: 20px;  
    left: 0;  
    width: 250px;  
    margin-left: 50px;  
    box-sizing: border-box;  
    padding: 10px;  
	font-size: 10px;
  }
</style>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Â© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script>
<script>
	MathJax = {

		tex: {
			inlineMath: [['$', '$'], ['\\(', '\\)']],
			displayMath: [['$$', '$$'], ['\\[', '\\]']],
			
		}
	};
</script>



  
</div>

</body>
</html>
